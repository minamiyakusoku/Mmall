<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>购物车</title>
	<link rel="stylesheet" href="css/reset.css" />
	<link rel="stylesheet" href="css/shopCart.css" />
	<script src="them/jquery/jquery-1.7.2.js"></script>
	
	<style>
	</style>
</head>
<body>
	<header>
		<div class="header clearfix">
			<a class="fl" href="index.html">
				<h1>
					<div class="h1_box clearfix">
						<img class="height_min fl" src="img/mi-home.png"  alt="">
						<img class="fl" src="img/mi-logo.png" alt="">
					</div>
				</h1>	
			</a>
			<div class="title fl">
				<h2 class="fl">
					我的购物车
				</h2>
				<p class="hint fl">
					温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算
				</p>
				<ul class="title_item fr">
					<li class="userName fl">
						123456789<span></span>
						<ul class="user_menu">
							<li><a href="#">个人中心</a></li>
							<li><a href="#">评价晒单</a></li>
							<li><a href="#">我的喜欢</a></li>
							<li><a href="#">退出登录</a></li>
						</ul>
					</li>
					<li class="indent fl">
						我的订单
					</li>
				</ul> 
			</div>
		</div>
	</header>
	<div id="conetent_wrapper">
		<div id="content">
			<div class="control_box clearfix">
				<div class="radio_box fl">
					<input type="checkbox" id="quanxuan" name="sport" value="">
					<span>全选</span>
				</div>
				<div class="sp_name fl">
					商品名称
				</div>
				<div class="sp_price fl">
					单价
				</div>
				<ul class="sp_det fr">
					<li class="sp_det_item fl">数量</li>
					<li class="sp_det_item fl">小计</li>
					<li class="sp_det_item fl">操作</li>
				</ul>
			</div>
			<div class="details">

			</div>
			<div class="kxsp_box">
				<ul>
					<!--<li id="tj302" class="kxsp_box_item">-->
						<!--<span class="add_sp"></span><span class="add_name">+249元得小米vr眼镜</span>-->
					<!--</li>-->
				</ul>
			</div>
			<div class="cart_bar">
				<div class="fl section_left">
					<a href="index.html"><p class="jxgw">继续购物</p></a>
					<p class="tongji">
						共<span class="commodity_amount">1</span>件商品,已选择<span class="selected_amount">0</span>件
					</p>
				</div>
				<div class="btn_disabled fr">
					去结算
					<div class="btn_disabled_ts">
						请勾选需要结算的商品
						<span></span>
					</div>
				</div>
				<div class="fr total_prices">
					<p class="fl total_prices_text">合计（不含运费）</p>
					<p class="fl total_prices_count">0</p>元
				</div>
			</div>
			
		</div>
		
	</div>
	<div class="footer">
		<div class="fuwu">
			<ul>
				<li>预约维修服务</li>
				<li>7天无理由退货</li>
				<li>15天免费换货</li>
				<li>满150元包邮</li>
				<li>520余家售后网点</li>
			</ul>
		</div>
		<div class="fuwu_det clearfix">
			<ul class="fl fuwu_det_item">
				<li class="fuwu_det_i fl">
					<p>帮助中心</p>
					<ul>
						<li>账户管理</li>
						<li>购物指南</li>
						<li>订单操作</li>
					</ul>
					
				</li>
				<li class="fuwu_det_i fl">
					<p>帮助中心</p>
					<ul>
						<li>账户管理</li>
						<li>购物指南</li>
						<li>订单操作</li>
					</ul>
				</li>
				<li class="fuwu_det_i fl">
					<p>帮助中心</p>
					<ul>
						<li>账户管理</li>
						<li>购物指南</li>
						<li>订单操作</li>
					</ul>
				</li>
				<li class="fuwu_det_i fl">
					<p>帮助中心</p>
					<ul>
						<li>账户管理</li>
						<li>购物指南</li>
						<li>订单操作</li>
					</ul>
				</li>
				<li class="fuwu_det_i fl">
					<p>帮助中心</p>
					<ul>
						<li>账户管理</li>
						<li>购物指南</li>
						<li>订单操作</li>
					</ul>
				</li>
				<li class="fuwu_det_i fl">
					<p>帮助中心</p>
					<ul>
						<li>账户管理</li>
						<li>购物指南</li>
						<li>订单操作</li>
					</ul>
				</li>
			</ul>
			<ul class="fl fuwu_det_tel">
				<li class="fuwu_det_num">400-100-5678</li>
				<li class="fuwu_det_time">周一至周日 8:00-18:00</li>
				<li class="fuwu_det_time">（仅收市话费）</li>
				<li class="fuwu_det_btn">24小时在线客服</li>
			</ul>
		</div>
		<div class="bottom clearfix">
			<div class="logo_b fl"></div>
			<div class="bottom_text fl">
				<ul>
					<li>小米商城</li>
					<li>MIUI</li>
					<li>米聊</li>
					<li>多看书城</li>
					<li>小米路由器</li>
					<li>视频电话</li>
					<li>小米天猫店</li>
					<li>小米淘宝直营店</li>
					<li>Select Region</li>
				</ul>
				<p>©mi.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号 京网文[2014]0059-0009号</p>
				<p>违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</p>
			</div>
			<div class="bottom_img fl">
				<img src="img/truste.png" alt="">
				<img src="img/v-logo-1.png" alt="">
				<img src="img/v-logo-2.png" alt="">
				<img src="img/v-logo-3.png" alt="">
			</div>
		</div>
	</div>


		<div class="delete_box">
			<div class="delete_box_children">
				<span class="delete_box_close"></span>
				<p class="delete_box_text">确定删除吗？</p>
				<div class="delete_box_btnbox">
					<div class="fl delete_box_btn delete_box_abolish">取消</div>
					<div class="delete_box_btn delete_box_confirm fr">确定</div>
				</div>
			</div>
		</div>
		
	<script>
        //获取商品总数
        function hq_sp_count() {
            $.ajax({
                url:'/cart/get_cart_product_count.do',
                type:'post',
                success:function(res){
                    $('.commodity_amount').html(res.data);
                },
                error:function(){

                }
            });
        }
        hq_sp_count();
		//选中商品的个数
        var act_count=0;
        //选中商品的总价
        var act_rmb=0;
        //每件商品选中的个数
        var item_count;

        $.ajax({
            url:'/cart/list.do',
            type:'post',
            success:function(res){
                var goods_list=res.data.cartProductVoList;
                var imageHost=res.data.imageHost;
                act_rmb=res.data.cartTotalPrice;
                //console.log(goods_list);
                $.each(goods_list,function(index,val){
                    //index 索引
                    //val每一项的值
                    $('.details').append('<ul id="'+val.productId+'" class="details_item clearfix"><li class="check_sp fl"><input type="checkbox" name="check_commodity" value=""><div class="img_box"><img src="'+(imageHost+val.productMainImage)+'" height="60" width="60" alt=""></div></li><li class="name_sp fl">'+val.productName+'</li><li class="price_sp fl"><span class="commodity_price">'+val.productPrice+'</span>元</li><li class="det_sp fl"><ul><li class="det_sp_item fl"><div class="count_box clearfix"><span class="count_box_item fl count_j">-</span><span class="count_box_item fl count">'+val.quantity+'</span><span class="count_box_item fl count_z">+</span></div></li><li class="det_sp_item fl"><span class="commodity_price_sum"> '+(val.quantity*val.productPrice)+'元</span></li><li class="det_sp_item fl"><span class="delete_sp"></span></li></ul></li></ul>');
                    if(val.productChecked){
						$('input:checkbox[name="check_commodity"]').eq(index).attr("checked",true);
                        act_count+=val.quantity;
                        //改变数量
                        $('.count_j').eq(index).on("click",function(){
                            item_count=$('.count').eq(index).html();
                            item_count--;
                            if(item_count<1){
                                item_count=1;
                                return ;
                            }
                            $('.count').eq(index).html(item_count);
                            $('.commodity_price_sum').eq(index).html(item_count*val.productPrice);
                            act_rmb-=val.productPrice;
                            act_count--;
                            $('input:checkbox[name="check_commodity"]').eq(index).off("click").on("click",check_un);
                            //已选商品 的个数
                            $('.selected_amount').html(act_count);
                            //已选商品的总价
                            $('.total_prices_count').html(act_rmb);
                            //调用修改数量接口
                            $.ajax({
                                url:'/cart/update.do',
                                data:{
                                    'count':item_count,
                                    'productId':val.productId
                                },
                                type:'post',
                                success:function(res){
                                    console.log(res.data.cartTotalPrice);
                                    //调获取购物车商品个数接口
                                    hq_sp_count();
                                },
                                error:function(){

                                }
                            });
                        });
                        $('.count_z').eq(index).on("click",function(){
                            item_count=$('.count').eq(index).html();
                            item_count++;
                            $('.count').eq(index).html(item_count);
                            $('.commodity_price_sum').eq(index).html(item_count*val.productPrice);
                            act_rmb+=val.productPrice;
                            act_count++;
                            $('input:checkbox[name="check_commodity"]').eq(index).off("click").on("click",check_un);
                            //已选商品 的个数
                            $('.selected_amount').html(act_count);
                            //已选商品的总价
                            $('.total_prices_count').html(act_rmb);
                            //调用修改数量接口
                            $.ajax({
                                url:'/cart/update.do',
                                data:{
                                    'count':item_count,
                                    'productId':val.productId
                                },
                                type:'post',
                                success:function(res){
                                    console.log(res.data.cartTotalPrice);
                                    //调获取购物车商品个数接口
                                    hq_sp_count();
                                },
                                error:function(){

                                }
                            });
                        });
					}
                    //选中与取消选中函数
                    function check_un(){
                        if($(this).attr("checked")){
                            //绑定改变数量函数
                            $('.count_j').eq(index).off("click").on("click",function(){
                                item_count=$('.count').eq(index).html();
                                item_count--;
                                if(item_count<1){
                                    item_count=1;
                                    return ;
                                }
                                $('.count').eq(index).html(item_count);
                                $('.commodity_price_sum').eq(index).html(item_count*val.productPrice);
                                act_rmb-=val.productPrice;
                                act_count--;
                                $('input:checkbox[name="check_commodity"]').eq(index).off("click").on("click",check_un);
                                //已选商品 的个数
                                $('.selected_amount').html(act_count);
                                //已选商品的总价
                                $('.total_prices_count').html(act_rmb);
                                //调用修改数量接口
                                $.ajax({
                                    url:'/cart/update.do',
                                    data:{
                                        'count':item_count,
                                        'productId':val.productId
                                    },
                                    type:'post',
                                    success:function(res){
                                        console.log(res.data.cartTotalPrice);
                                        //调获取购物车商品个数接口
                                        hq_sp_count();
                                    },
                                    error:function(){

                                    }
                                });
                            });
                            $('.count_z').eq(index).off("click").on("click",function(){
                                item_count=$('.count').eq(index).html();
                                item_count++;
                                $('.count').eq(index).html(item_count);
                                $('.commodity_price_sum').eq(index).html(item_count*val.productPrice);
                                act_rmb+=val.productPrice;
                                act_count++;
                                $('input:checkbox[name="check_commodity"]').eq(index).off("click").on("click",check_un);
                                //已选商品 的个数
                                $('.selected_amount').html(act_count);
                                //已选商品的总价
                                $('.total_prices_count').html(act_rmb);
                                //调用修改数量接口
                                $.ajax({
                                    url:'/cart/update.do',
                                    data:{
                                        'count':item_count,
                                        'productId':val.productId
                                    },
                                    type:'post',
                                    success:function(res){
                                        console.log(res.data.cartTotalPrice);
                                        //调获取购物车商品个数接口
                                        hq_sp_count();
                                    },
                                    error:function(){

                                    }
                                });
                            });
                            act_count+=Number($('.count').eq(index).html());
                            act_rmb+=Number($('.count').eq(index).html())*val.productPrice;
                            //设置总数  选中个数  总价

                            $('.selected_amount').html(act_count);
                            $('.total_prices_count').html(act_rmb);

                            //调选中接口
                            $.ajax({
                                url:'/cart/select.do',
                                data:{
                                    'productId':val.productId
                                },
                                type:'post',
                                success:function(res){
                                    $('.total_prices_count').html(res.data.cartTotalPrice);
                                },
                                error:function(){
                                    alert('添加失败，请重新添加');
                                }
                            });
                        }else{
                            //解除改变数量函数
                            $('.count_j').eq(index).off("click");
                            $('.count_z').eq(index).off("click");
                            act_count-=Number($('.count').eq(index).html());
                            act_rmb-=Number($('.count').eq(index).html())*val.productPrice;
                            //设置选中个数与总价
                            $('.selected_amount').html(act_count);
                            $('.total_prices_count').html(act_rmb);
                            //调反选接口
                            $.ajax({
                                url:'/cart/un_select.do',
                                data:{
                                    'productId':val.productId
                                },
                                type:'post',
                                success:function(res){
                                    $('.total_prices_count').html(res.data.cartTotalPrice);
                                },
                                error:function(){

                                }
                            });
                        }

                        //点击选中时看看 是不是全选了
                        if(act_count==$('.commodity_amount').html()){
                            $('#quanxuan').attr("checked",true);
                        }else{
                            $('#quanxuan').attr("checked",false);
                        }
                    }
					//选中与取消选中
                    $('input:checkbox[name="check_commodity"]').eq(index).off("click").on("click",check_un);

                });
                //已选商品 的个数
                $('.selected_amount').html(act_count);
                //已选商品的总价
                $('.total_prices_count').html(act_rmb);
                //加载页面时看看 是不是全选了
               if(act_count==$('.commodity_amount').html()){
                   $('#quanxuan').attr("checked",true);
			   }
				//全选按钮的点击
				$('#quanxuan').on("click",function(){
					if($(this).attr("checked")){
					    //全选重置为0
                        act_count=0;
                        act_rmb=0;
						$('input:checkbox[name="check_commodity"]').each(function(index,element){
                            //index 索引
                            //element每一个元素
							$(this).attr("checked",true);
                            act_count+=Number($('.count').eq(index).html());
                            act_rmb+=Number($('.count').eq(index).html())*Number($('.commodity_price').eq(index).html());
                        });
                        $('.selected_amount').html(act_count);
                        $('.total_prices_count').html(act_rmb);
                        //调全部选中接口
                        $.ajax({
                            url:'/cart/select_all.do',
                            type:'post',
                            success:function(res){
                                console.log(res.data.cartTotalPrice)
                            },
                            error:function(){

                            }
                        });
					}else{
					    //全不选就是 选中为0  总价为0 然后全部取消选中
                        act_count=0;
                        act_rmb=0;
                        $('input:checkbox[name="check_commodity"]').each(function(index,element){
                            //index 索引
                            //element每一个元素
                            $(this).attr("checked",false);
                        });
                        $('.selected_amount').html(act_count);
                        $('.total_prices_count').html(act_rmb);
                        //调全部反选接口
                        $.ajax({
                            url:'/cart/un_select_all.do',
                            type:'post',
                            success:function(res){
                                console.log(res.data.cartTotalPrice)
                            },
                            error:function(){

                            }
                        });
					}

				});
            },
            error:function(){

            }
        });




        //提示框的显示隐藏
        function sp_count(checkboxCount){
        	//提示框的显示隐藏
        	$("input:checkbox[name='check_commodity']").each(function() {
			        if($(this).attr('checked')) {
		     			checkboxCount++;
		     		}
			});
     		if(checkboxCount==0){
     			$('.btn_disabled_ts').css('display','block');
     		}else{
     			$('.btn_disabled_ts').css('display','none');
     		}
     		//已选商品 的个数
     		$('.selected_amount').html(checkboxCount);
     		//购物车商品个数
     		$('.commodity_amount').html($("input:checkbox[name='check_commodity']").length);
        }





        //推荐商品的添加函数
        //        function recommend(){
        //        	$('.add_sp').click(function(){
        //	        	operate_id=$(this).parent().attr('id');
        //	        	$(this).parent().remove();
        //				$('.details').append('<ul id="'+operate_id+'" class="details_item clearfix"><li class="check_sp fl"><input type="checkbox" checked  disabled="disabled" name="check_commodity" value=""><div class="img_box"><img src="img/top.jpg" height="60" width="60" alt=""></div></li><li class="name_sp fl">小米vr眼镜</li><li class="price_sp fl"><span class="commodity_price">249</span>元</li><li class="det_sp fl"><ul><li class="det_sp_item fl"><div class="count_box clearfix"><span class="count_box_item fl count_j">-</span><span class="count_box_item fl count">1</span><span class="count_box_item fl count_z">+</span></div></li><li class="det_sp_item fl"><span class="commodity_price_sum"> 249元</span></li><li class="det_sp_item fl"><span class="delete_sp"></span></li></ul></li></ul>');
        //					//添加
        //					operate();
        //					check_all();
        //			});
        //        }
        //        recommend();
	</script>
	
</body>
</html>