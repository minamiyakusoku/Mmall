<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>艾家艾产品线上销售平台</title>
    <link rel="shortcut icon" href="../img/favicon.ico">
    <link rel="stylesheet" href="../css/reset.css"/>
    <link rel="stylesheet" href="../css/user-address.css"/>
    <script src="../them/jquery/jquery-1.7.2.js"></script>
    <script src="../them/city/Popt.js"></script>
    <script src="../them/city/cityJson.js"></script>
    <script src="../them/city/citySet.js"></script>

</head>
<body>
<!--头部-->
<div class="site-topbar">
    <div class="container">
        <div class="topbar-nav">
            <a href="javascript:;">在线客服</a>
            <a href="javascript:;">艾百科</a>
            <a href="javascript:;">养生百科</a>
            <a href="javascript:;">艾家商城移动版</a>
        </div>
        <div class="topbar-cart">
            <a href="javascript:;" class="cart-mini">
                <span class="cart"></span>
                <span>购物车</span>
                <span class="gwc_number"></span>
            </a>
        </div>
        <div class="topbar-info">
            <div class="login" style="display: inline-block">
                <a href="login.html">登录</a>
                <a href="register.html">注册</a>
            </div>
            <a href="javascript:;">消息通知</a>
            <!--<div class="info_select">
                <a href="personal-center.html">个人中心</a>
                <a href="user-favorite.html">我的喜欢</a>
                <a href="login.html">退出登录</a>
            </div>-->
        </div>
    </div>
</div>
<!--导航-->
<div class="site-header">
    <div class="container">
        <div class="header-logo">
            <a href="indent.html">
                <span class="logo"></span>
            </a>
        </div>
        <div class="header-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="javacsript:;" class="link">
                        <span>小米手机</span>
                    </a>

                    <div class="header-nav-menu">
                        <div class="container">
                            <ul class="children-list clearfix">
                                <li style="border-left: 0">
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="javacsript:;" class="link">
                        <span>红米</span>
                    </a>

                    <div class="header-nav-menu">
                        <div class="container">
                            <ul class="children-list clearfix">
                                <li style="border-left: 0">
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="javacsript:;" class="link">
                        <span>平板·笔记本</span>
                    </a>

                    <div class="header-nav-menu">
                        <div class="container">
                            <ul class="children-list clearfix">
                                <li style="border-left: 0">
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="javacsript:;" class="link">
                        <span>电视</span>
                    </a>

                    <div class="header-nav-menu">
                        <div class="container">
                            <ul class="children-list clearfix">
                                <li style="border-left: 0">
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <div class="figure figure-thumb">
                                        <a href="javascript:;">
                                            <img src="http://c1.mifile.cn/f/i/g/2015/cn-index/hmn4xtb!160x110.jpg">

                                            <p class="tittle">红米Note 4X</p>

                                            <p class="price">999元</p>
                                        </a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="header-search">
            <div class="search-form clearfix">
                <input class="search-text" type="text">
                <input type="submit" class="search-btn" value=" ">

                <div class="search-hot-words">
                    <a href="javasctipy:;">艾灸</a>
                    <a href="javascript:;">艾棒</a>
                </div>
                <div class="keyword-list hide">
                    <ul class="result-list"></ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--中间-->
<div class="breadcrumbs">
    <div class="container">
        <a href="index.html">首页</a>
        <span>&gt;</span>
        <a href="javascript:;">收货地址</a>
    </div>
</div>
<div class="user-main">
    <div class="container">
        <div class="row clearfix">
            <div class="left-box">
                <div class="uc-sub-box">
                    <div class="uc-nav-box">
                        <div class="box-hd">
                            <h3 class="tittle">个人中心</h3>
                        </div>
                        <div class="box-bd">
                            <ul class="uc-nav-list">
                                <li>
                                    <a href="personal-center.html">我的个人中心</a>
                                </li>
                                <li class="active">
                                    <a href="javascript:;">收货地址</a>
                                </li>
                                <li>
                                    <a href="user-favorite.html">喜欢的商品</a>
                                </li>
                                <li>
                                    <a href="indent.html">我的订单</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right-box">
                <div class="uc-box">
                    <div class="uc-content-box">
                        <div class="box-hd">
                            <h2 class="title">收获地址</h2>
                        </div>
                        <div class="box-bd">
                            <div class="user-address-list clearfix">
                                <div class="address-item address-item-new">
                                    <div class="add">+</div>
                                    <p>添加新地址</p>
                                </div>
                                <!--<div class="address-item newadd" id="1">
                                    <dl>
                                        <dt>
                                            <em class="uname">王哇</em>
                                        </dt>
                                        <dd class="utel">176****6602</dd>
                                        <dd class="uaddress">北京 北京市 东城区 建国门街道 <br>东北街23-23号 (100011)</dd>
                                    </dl>
                                    <div class="actions">
                                        <a href="javascript:;" class="modify revamp">修改</a>
                                        <a href="javascript:;" class="modify del">删除</a>
                                    </div>
                                </div>-->
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--底部-->
<div class="footer">
    <div class="fuwu">
        <ul>
            <li>预约维修服务</li>
            <li>7天无理由退货</li>
            <li>15天免费换货</li>
            <li>满150元包邮</li>
            <li>520余家售后网点</li>
        </ul>
    </div>
    <div class="fuwu_det clearfix">
        <ul class="fl fuwu_det_item">
            <li class="fuwu_det_i fl">
                <p>帮助中心</p>
                <ul>
                    <li>账户管理</li>
                    <li>购物指南</li>
                    <li>订单操作</li>
                </ul>

            </li>
            <li class="fuwu_det_i fl">
                <p>帮助中心</p>
                <ul>
                    <li>账户管理</li>
                    <li>购物指南</li>
                    <li>订单操作</li>
                </ul>
            </li>
            <li class="fuwu_det_i fl">
                <p>帮助中心</p>
                <ul>
                    <li>账户管理</li>
                    <li>购物指南</li>
                    <li>订单操作</li>
                </ul>
            </li>
            <li class="fuwu_det_i fl">
                <p>帮助中心</p>
                <ul>
                    <li>账户管理</li>
                    <li>购物指南</li>
                    <li>订单操作</li>
                </ul>
            </li>
            <li class="fuwu_det_i fl">
                <p>帮助中心</p>
                <ul>
                    <li>账户管理</li>
                    <li>购物指南</li>
                    <li>订单操作</li>
                </ul>
            </li>
            <li class="fuwu_det_i fl">
                <p>帮助中心</p>
                <ul>
                    <li>账户管理</li>
                    <li>购物指南</li>
                    <li>订单操作</li>
                </ul>
            </li>
        </ul>
        <ul class="fl fuwu_det_tel">
            <li class="fuwu_det_num">400-100-5678</li>
            <li class="fuwu_det_time">周一至周日 8:00-18:00</li>
            <li class="fuwu_det_time">（仅收市话费）</li>
            <li class="fuwu_det_btn">24小时在线客服</li>
        </ul>
    </div>
    <div class="bottom clearfix">
        <div class="logo_b fl"></div>
        <div class="bottom_text fl">
            <ul>
                <li>艾家商城</li>
                <li>AiJia</li>
                <li>艾聊</li>
                <li>多看书城</li>
                <li>艾生活艾草</li>
                <li>艾疗</li>
                <li>艾家天猫店</li>
                <li>艾家淘宝直营店</li>
                <li>aijia.com</li>
            </ul>
            <p>aijia.com 京ICP证110507号 京ICP备10046444号 京公网安备11010802020134号 京网文[2014]0059-0009号</p>
            <p>违法和不良信息举报电话：185-0130-1238，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</p>
        </div>
        <div class="bottom_img fl">
            <img src="../../img/truste.png" alt="">
            <img src="../../img/v-logo-1.png" alt="">
            <img src="../../img/v-logo-2.png" alt="">
            <img src="../../img/v-logo-3.png" alt="">
        </div>
    </div>
</div>
<!--遮罩-->
<div class="shade"></div>
<!--弹层-->
<div class="modal">
    <div class="modal-header">
        <span>添加收货地址</span>
        <a href="javascript:;" class="close"></a>
    </div>
    <div class="modal-body">
        <div class="form-box clearfix">
            <form class="address" id="add">
                <input type="text" placeholder="姓名" style="width: 228px;">
                <input type="text" placeholder="手机号" style="width: 228px;">
                <input type="text" id="city" placeholder="选择 省 / 市 / 区 / 街道" style="width: 508px;">
                <textarea placeholder="详细地址"></textarea>
                <input type="text" placeholder="邮政编码" class="zipCode" style="width: 228px;">
                <input type="text" placeholder="地址标签" style="width: 228px;">
                <p class="text" style="font-size: 14px;color: red"></p>
            </form>
        </div>
    </div>
    <div class="modal-footer">
        <a href="javascript:;" class="btn btn-primary save">保存</a>
        <a href="javascript:;" class="btn btn-gray">取消</a>
    </div>
</div>
</body>
</html>
<script>
    /*存搜索字段*/
    $('.search-btn').click(function(){
        var html=$('.search-text').val();
        if(html.length==0){
            return;
        }
        var cookietime = new Date();
        var date = new Date();
        cookietime.setTime(date.getTime() + (24 * 60 * 60 * 1000));
        $.cookie("search", html,{expires:cookietime});
        window.location.href = "search.html";
    });
    $.ajax({
        url:'/user/get_user_info.do',
        type:'post',
        success:function(result){
            var name=result.data.username;
            if(!result.status){
                $.ajax({
                    url: '/cart/get_cart_product_count.do',
                    type: 'post',
                    success: function (res) {
                        console.log(res.data);
                        $('.gwc_number').html('('+res.data+')');
                        $('.cart-mini').css('background','rgba(255, 103, 0,.7)');
                    }
                });
                $('.login').html('<a href="javascript:;">'+name+' , 您好！</a><div class="info_select"> <a href="personal-center.html">个人中心</a> <a href="user-favorite.html">我的喜欢</a> <a href="javascript:;" class="changeInfo">修改信息</a><a href="javascript:;" class="quit">退出登录</a> </div>');
                $('.quit').click(function(){
                    $.ajax({
                        url:'/user/logout.do',
                        type:'post',
                        success:function(result){
                            if(!result.status){
                                $('.hint').html('');
                                window.location.href='index.html';
                            }
                        }
                    });
                });
                $('.changeInfo').click(function(){
                    window.location.href='change-information.html';
                });
            }
        }
    });
    var _width=$(window).width();
    $('.header-nav-menu').css('width',_width);
    $('.header-nav-menu').css('left','-40px');
    /*导航*/
    $('.header-nav .nav-list li').mouseover(function () {
        $(this).find($('.header-nav-menu')).css('display', 'block');
    });
    $('.header-nav .nav-list li').mouseout(function () {
        $(this).find($('.header-nav-menu')).css('display', 'none');
    });

    $('.uc-nav-list li').click(function () {
        $(this).addClass('active').siblings().removeClass('active');
    });
    $('.close').click(function () {
        $('.text').html('');
        $('.shade').css('display', 'none');
        $('.modal').slideUp("fast");
    });
    $('.btn-gray').click(function () {
        $('.text').html('');
        $('.shade').css('display', 'none');
        $('.address').children().val('');
        $('.modal').slideUp("fast");
    });
    $('.address-item-new').click(function () {
        $('.address').children().val('');
        $('.shade').css('display', 'block');
        $('.modal').slideDown("fast");
        _str='add';
    });
    /*地址*/
    $("#city").click(function (e) {
        SelCity(this, e);
    });

    $.ajax({
        url:'/shipping/list.do',
        data:{
            'pageNum':1,
            'pageSize':20
        },
        success:function(str){
            if(!str.status){
                for(var i=0;i<str.data.list.length;i++){
                    var content='<div class="address-item newadd" id='+str.data.list[i].id+'> <dl> <dt> <em class="uname">'+str.data.list[i].receiverName+'</em> </dt> <dd class="utel">'+str.data.list[i].receiverMobile+'</dd> <dd class="uaddress">'+str.data.list[i].receiverProvince+'- '+str.data.list[i].receiverCity+'-'+str.data.list[i].receiverDistrict+'<p style="text-overflow: ellipsis; overflow: hidden;white-space:nowrap;">'+str.data.list[i].receiverAddress+'</p>('+str.data.list[i].receiverZip+')</dd> </dl> <div class="actions"> <a href="javascript:;" class="modify revamp">修改</a> <a href="javascript:;" class="modify del">删除</a> </div> </div>';
                    $('.user-address-list').append(content);
                }
                delect();
                modification();
            }
        },error:function(){
        }
    });
    function delect(){
        $('.del').click(function () {
            var del=$(this).parent().parent();
            var shId=parseInt($(this).parent().parent().attr('id'));
            $.ajax({
                url:'/shipping/del.do',
                data:{
                    'shippingId':shId
                },
                success:function(str){
                    if(!str.status){
                        del.remove();
                        alert(str.data);
                    }
                },
                error:function(){
                }
            });
        });
    };
    var shId_reva;
    function modification(){
        $('.revamp').click(function(){
            _str='revamp';
            $('.text').html('');
            shId_reva=parseInt($(this).parent().parent().attr('id'));
            $.ajax({
                url:'/shipping/select.do',
                data:{
                    'shippingId':shId_reva
                },
                success:function(str){
                    if(!str.status){
                        $('.shade').css('display', 'block');
                        $('.modal').slideDown("fast");
                        $('.modal-header span').html('修改收货地址');
                        $('#add input').eq(0).val(str.data.receiverName);
                        $('#add input').eq(1).val(str.data.receiverMobile);
                        $("#city").val(str.data.receiverProvince+'-'+str.data.receiverCity+'-'+str.data.receiverDistrict);
                        $('#add textarea').val(str.data.receiverAddress);
                        $('#add input').eq(3).val(str.data.receiverZip);
                    }
                }
            });

        });
    };
    var _str;
    $('.save').click(function(){
        if(!$('#add input').eq(0).val()||!$('#add input').eq(1).val()||!$('#city').val()||!$('.zipCode').val()||!$('#add textarea').val()){
            $('.text').html('填写完整');
            return;
        }
        if($('.zipCode').val().length!=6){
            $('.text').html('填入正确的邮政编码');
            return false;
        }
        var reg=/^1\d{10}$/;
        if(!reg.test($('#add input').eq(1).val())){
            $('.text').html('填入正确的手机号');
            return false;
        }
       if(_str=='add'){
           $.ajax({
               url:'/shipping/add.do',
               data:{
                   'receiverName':$('#add input').eq(0).val(),
                   'receiverMobile':$('#add input').eq(1).val(),
                   'receiverProvince':$('#add input').eq(5).val(),
                   'receiverCity':$('#add input').eq(4).val(),
                   'receiverDistrict':$('#add input').eq(3).val(),
                   'receiverAddress':$('#add textarea').val(),
                   'receiverZip':$('#add input').eq(6).val()
               },
               success:function(str){
                   if(!str.status){
                       var shippingId=str.data.shippingId;
                       var content='<div class="address-item newadd" id='+shippingId+'> <dl> <dt> <em class="uname">'+$('#add input').eq(0).val()+'</em> </dt> <dd class="utel">'+$('#add input').eq(1).val()+'</dd> <dd class="uaddress">'+$('#add input').eq(2).val()+' <p style="text-overflow: ellipsis; overflow: hidden;white-space:nowrap;">'+$('#add textarea').val()+' ('+$('#add input').eq(6).val()+')</dd> </dl> <div class="actions"> <a href="javascript:;" class="modify revamp">修改</a> <a href="javascript:;" class="modify del">删除</a> </div> </div>';
                       $('.user-address-list').append(content);
                       $('.shade').css('display', 'none');
                       $('.modal').slideUp("fast");
                       delect();
                       modification();
                   }else{
                       alert("添加失败");
                   }
               },
               error:function(){
               }
           });
       }else{
           var address= $("#city").val();
           var arr=address.split('-');
           $.ajax({
               url:'/shipping/update.do',
               data:{
                   id:shId_reva,
                   'receiverName':$('#add input').eq(0).val(),
                   'receiverMobile':$('#add input').eq(1).val(),
                   'receiverProvince':arr[0],
                   'receiverCity':arr[1],
                   'receiverDistrict':arr[2],
                   'receiverAddress':$('#add textarea').val(),
                   'receiverZip':$('.zipCode').val()
               },
               success:function(str){
                   console.log(str);
                   if(!str.status){
                       $('.shade').css('display', 'none');
                       $('.modal').slideUp("fast");
                       location.reload();
                   }
               }
           });
       }

    });

</script>